<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku - NeuroMente</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        .sudoku-container {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 0;
            background: var(--glass-border);
            border: 3px solid var(--accent-green);
            border-radius: 8px;
            overflow: hidden;
            margin: 30px auto;
            max-width: 450px;
        }

        .sudoku-cell {
            aspect-ratio: 1;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .sudoku-cell .notes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 1px;
            position: absolute;
            inset: 2px;
            font-size: 0.5rem;
            font-weight: 400;
            color: var(--text-secondary);
        }

        .sudoku-cell .notes span {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sudoku-cell:nth-child(3n):not(:nth-child(9n)) {
            border-right: 2px solid var(--accent-green);
        }

        .sudoku-cell:nth-child(n+19):nth-child(-n+27),
        .sudoku-cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid var(--accent-green);
        }

        .sudoku-cell.fixed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent-green);
            cursor: default;
        }

        .sudoku-cell.selected {
            background: rgba(59, 130, 246, 0.3);
            box-shadow: inset 0 0 0 2px var(--accent-blue);
        }

        .sudoku-cell.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 20px auto;
        }

        .number-btn {
            padding: 15px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .number-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-green);
        }

        .mode-toggle-btn {
            padding: 12px 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            margin: 10px auto;
            display: block;
        }

        .mode-toggle-btn.active {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-box {
            background: var(--glass-bg);
            padding: 15px 20px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            min-width: 120px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-green);
        }

        @media (max-width: 768px) {
            .sudoku-grid {
                max-width: 100%;
            }

            .sudoku-cell {
                font-size: 1rem;
            }

            .sudoku-cell .notes {
                font-size: 0.45rem;
            }

            .number-pad {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }

            .number-btn {
                padding: 12px;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body class="dark-theme">
    <nav class="glass-nav">
        <a href="index.html" class="logo">Neuro<span>Mente</span></a>
        <div class="streak-badge">
            <i class="fire-icon">üî•</i>
            <span id="global-streak">0</span>
        </div>
    </nav>

    <main class="container">
        <header class="game-header">
            <a href="entrenar.html" class="back-btn">‚Üê Volver</a>
            <h1 class="gradient-text">Sudoku</h1>
        </header>

        <div class="sudoku-container">
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-label">Tiempo</div>
                    <div class="stat-value" id="timer">00:00</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Mejor Tiempo</div>
                    <div class="stat-value" id="best-time">--:--</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Completados</div>
                    <div class="stat-value" id="completed">0</div>
                </div>
            </div>

            <!-- Difficulty Selector -->
            <div style="margin: 20px 0; text-align: center;">
                <label
                    style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--text-secondary);">Nivel
                    de Dificultad</label>
                <select id="difficulty-select" onchange="newGame()"
                    style="background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-primary); padding: 10px 20px; border-radius: 8px; font-size: 1rem; cursor: pointer; width: 100%; max-width: 300px;">
                    <option value="20">F√°cil (20 vac√≠as)</option>
                    <option value="30">Principiante (30 vac√≠as)</option>
                    <option value="40" selected>Medio (40 vac√≠as)</option>
                    <option value="50">Dif√≠cil (50 vac√≠as)</option>
                    <option value="55">Extremo (55 vac√≠as)</option>
                    <option value="60">Imposible (60 vac√≠as)</option>
                    <option value="64">Profesional (64 vac√≠as)</option>
                </select>
            </div>

            <div class="sudoku-grid" id="sudoku-grid"></div>

            <button class="mode-toggle-btn" id="mode-toggle" onclick="toggleMode()">
                üìù Modo: N√∫mero
            </button>

            <div class="number-pad">
                <button class="number-btn" onclick="inputNumber(1)">1</button>
                <button class="number-btn" onclick="inputNumber(2)">2</button>
                <button class="number-btn" onclick="inputNumber(3)">3</button>
                <button class="number-btn" onclick="inputNumber(4)">4</button>
                <button class="number-btn" onclick="inputNumber(5)">5</button>
                <button class="number-btn" onclick="inputNumber(6)">6</button>
                <button class="number-btn" onclick="inputNumber(7)">7</button>
                <button class="number-btn" onclick="inputNumber(8)">8</button>
                <button class="number-btn" onclick="inputNumber(9)">9</button>
                <button class="number-btn" onclick="inputNumber(0)">‚úï</button>
            </div>

            <button onclick="newGame()" class="primary-btn" style="margin-top: 20px;">Nuevo Juego</button>
        </div>
    </main>

    <div id="notification" class="notification hidden"></div>

    <script src="js/main.js"></script>
    <script>
        let grid = [];
        let solution = [];
        let notes = []; // Store notes for each cell
        let selectedCell = null;
        let timer = 0;
        let timerInterval = null;
        let bestTime = localStorage.getItem('sudokuBestTime') || null;
        let completed = localStorage.getItem('sudokuCompleted') || 0;
        let notesMode = false; // Toggle between number and notes mode

        document.addEventListener('DOMContentLoaded', () => {
            if (bestTime) {
                document.getElementById('best-time').innerText = formatTime(parseInt(bestTime));
            }
            document.getElementById('completed').innerText = completed;
            newGame();
        });

        function newGame() {
            clearInterval(timerInterval);
            timer = 0;
            updateTimer();

            // Get selected difficulty
            const difficulty = parseInt(document.getElementById('difficulty-select').value);

            // Generate a simple Sudoku puzzle
            solution = generateSolution();
            grid = JSON.parse(JSON.stringify(solution));

            // Initialize notes array
            notes = Array(9).fill(null).map(() => Array(9).fill(null).map(() => new Set()));

            // Remove numbers based on difficulty
            let removed = 0;
            while (removed < difficulty) {
                const row = Math.floor(Math.random() * 9);
                const col = Math.floor(Math.random() * 9);
                if (grid[row][col] !== 0) {
                    grid[row][col] = 0;
                    removed++;
                }
            }

            renderGrid();
            startTimer();
        }

        function generateSolution() {
            // Simple Sudoku generation - start with a valid base pattern
            const base = [
                [5, 3, 4, 6, 7, 8, 9, 1, 2],
                [6, 7, 2, 1, 9, 5, 3, 4, 8],
                [1, 9, 8, 3, 4, 2, 5, 6, 7],
                [8, 5, 9, 7, 6, 1, 4, 2, 3],
                [4, 2, 6, 8, 5, 3, 7, 9, 1],
                [7, 1, 3, 9, 2, 4, 8, 5, 6],
                [9, 6, 1, 5, 3, 7, 2, 8, 4],
                [2, 8, 7, 4, 1, 9, 6, 3, 5],
                [3, 4, 5, 2, 8, 6, 1, 7, 9]
            ];

            // Shuffle to create variation
            return shuffleSudoku(base);
        }

        function shuffleSudoku(board) {
            // Simple shuffle: swap rows within blocks
            const newBoard = JSON.parse(JSON.stringify(board));
            for (let block = 0; block < 3; block++) {
                for (let i = 0; i < 3; i++) {
                    const r1 = block * 3 + Math.floor(Math.random() * 3);
                    const r2 = block * 3 + Math.floor(Math.random() * 3);
                    [newBoard[r1], newBoard[r2]] = [newBoard[r2], newBoard[r1]];
                }
            }
            return newBoard;
        }

        function toggleMode() {
            notesMode = !notesMode;
            const btn = document.getElementById('mode-toggle');
            if (notesMode) {
                btn.innerText = '‚úèÔ∏è Modo: Notas';
                btn.classList.add('active');
            } else {
                btn.innerText = 'üìù Modo: N√∫mero';
                btn.classList.remove('active');
            }
        }

        function renderGrid() {
            const gridEl = document.getElementById('sudoku-grid');
            gridEl.innerHTML = '';

            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'sudoku-cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;

                    if (solution[row][col] !== 0 && grid[row][col] !== 0) {
                        cell.classList.add('fixed');
                        cell.innerText = grid[row][col];
                    } else if (grid[row][col] !== 0) {
                        cell.innerText = grid[row][col];
                    } else if (notes[row][col].size > 0) {
                        // Render notes
                        const notesDiv = document.createElement('div');
                        notesDiv.className = 'notes';
                        for (let i = 1; i <= 9; i++) {
                            const noteSpan = document.createElement('span');
                            if (notes[row][col].has(i)) {
                                noteSpan.innerText = i;
                            }
                            notesDiv.appendChild(noteSpan);
                        }
                        cell.appendChild(notesDiv);
                    }

                    cell.onclick = () => selectCell(row, col);
                    gridEl.appendChild(cell);
                }
            }
        }

        function selectCell(row, col) {
            // Don't select fixed cells
            const cells = document.querySelectorAll('.sudoku-cell');
            cells.forEach(c => c.classList.remove('selected'));

            if (!cells[row * 9 + col].classList.contains('fixed')) {
                selectedCell = { row, col };
                cells[row * 9 + col].classList.add('selected');
            }
        }

        function inputNumber(num) {
            if (!selectedCell) return;

            const { row, col } = selectedCell;

            if (notesMode) {
                // Notes mode: toggle note
                if (num === 0) {
                    // Clear all notes
                    notes[row][col].clear();
                } else {
                    if (notes[row][col].has(num)) {
                        notes[row][col].delete(num);
                    } else {
                        notes[row][col].add(num);
                    }
                }
                renderGrid();
                // Re-select the cell
                selectCell(row, col);
            } else {
                // Number mode: place number
                grid[row][col] = num;

                // Clear notes when placing a number
                if (num !== 0) {
                    notes[row][col].clear();
                }

                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                cell.innerText = num === 0 ? '' : num;
                cell.classList.remove('error');

                // Remove notes div if exists
                const notesDiv = cell.querySelector('.notes');
                if (notesDiv) notesDiv.remove();

                // Check if correct
                if (num !== 0 && num !== solution[row][col]) {
                    cell.classList.add('error');
                }

                // Check if completed
                if (isComplete()) {
                    clearInterval(timerInterval);
                    showNotification('¬°Sudoku completado! üéâ');

                    completed++;
                    localStorage.setItem('sudokuCompleted', completed);
                    document.getElementById('completed').innerText = completed;

                    if (!bestTime || timer < parseInt(bestTime)) {
                        bestTime = timer;
                        localStorage.setItem('sudokuBestTime', bestTime);
                        document.getElementById('best-time').innerText = formatTime(timer);
                    }

                    markDayComplete();
                }
            }
        }

        function isComplete() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (grid[row][col] !== solution[row][col]) {
                        return false;
                    }
                }
            }
            return true;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timer++;
                updateTimer();
            }, 1000);
        }

        function updateTimer() {
            document.getElementById('timer').innerText = formatTime(timer);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
    </script>
</body>

</html>